# SHIFT AppSec 2019





### CSRF
- Интерактивный урок: https://www.hacksplaining.com/exercises/csrf
- Варианты защиты: https://habr.com/ru/post/318748/
- Описание и защита: https://learn.javascript.ru/csrf
- Обход при эксплуатации при типе данных JSON: https://www.geekboy.ninja/blog/exploiting-json-cross-site-request-forgery-csrf-using-flash/ и https://blog.appsecco.com/exploiting-csrf-on-json-endpoints-with-flash-and-redirects-681d4ad6b31b
- Описание, обход, эксплуатация: https://2017.zeronights.org/wp-content/uploads/materials/ZN17_MikhailEgorov%20_Neat_tricks_to_bypass_CSRF_protection.pdf
- Описание, защита - https://2017.zeronights.org/wp-content/uploads/materials/csrf_cors_etc.pdf

## Общая информация
# Описание

CSRF - подделка межсайтовых запросов, другими словами, это атака при которой хакер выполняет массу различных действий от имени других, зарегистрированных посетителей.

Атаки по подделке межсайтовых запросов (CSRF) происходит в два этапа:
1) Необходимо заставить жертву щелкнуть по ссылке или загрузить страницу злоумышленника. (Эта ссылка запускает поддельный запрос, содержащий вредоносный код. Вредоносный код обычно размещается на веб-сайте принадлежащим злоумышленнику, в другом домене.)
  

2) Необходимо отправить специально созданный запрос в браузер жертвы, который отправит законный запрос в веб-приложение (JavaScript вызывает form.submit, отправляя таким образом форму на mail.com). Запрос будет отправлен со значениями, которые хочет злоумышленник, включая любые файлы cookie, которые жертва связала с этим веб-сайтом. Таким образом, веб-приложение знает, что эта жертва может выполнять определенные действия на веб-сайте, и любой запрос, отправленный с использованием этих учетных данных HTTP или файлов cookie, будет считаться законным, даже если жертва будет отправлять запрос по команде злоумышленника.

##Защита

1) CSRF токен 
* генерируется рандомный токен, который привязывается к сессии; 
* токен подставляется в форму и сверяется при приеме запроса; 
* атакующий не знает токена, следовательно не сможет заставить пользователя отправить запрос.

2) Double Submit Cookie 
* передавать токен клиенту двумя методами: в куках и в одном из параметров ответа (header или внутри HTML); 
* в последующих запросах предоставляются оба полученных ранее токена (как cookie и как header, либо внутри POST данных формы);
* сервер обязан проверить на идентичность токен из cookie и токен, который явно прислал клиент (если оба токена совпадают, то запрос не подвергся CSRF-Атаке, в ином случае — логируем событие и отклоняем запрос).

3) SameSite Cookies (Chrome, Opera)
* cookie не нужно передавать, если запрос идет с сайта, отличного от того, на котором cookie была установлена (защита ресурса от CSRF без использования дополнительных инструментов);
* Chrome уже сейчас поддерживает эту возможность.




## Шпаргалка
### Markdown
Для написания информации по ресерчу используем Markdown-разметку.
Что понадобится:
- шпаргалка по синтаксису есть [тут](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet)
- лучше использовать удобный текстовый редактор (я использую [Sublime Text](https://www.sublimetext.com/))
- лучше в текстовом редакторе поставить плагин для предпроссмотра Markdown-файлов (я использую [этот](https://packagecontrol.io/packages/MarkdownPreview))





